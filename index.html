<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>コンディション記録テスト</title>
</head>
<body>
  <h1>コンディション記録（テスト）</h1>

  <form id="condition-form">
    <!-- 1. 日付 -->
    <label>
      日付：
      <input type="date" name="date" required />
    </label>
    <br />

    <!-- 2. 所属 -->
    <label>
      所属：
      <input type="text" name="team" required />
    </label>
    <br />

    <!-- 3. 名前 -->
    <label>
      名前：
      <input type="text" name="name" required />
    </label>
    <br />

    <button type="submit">送信</button>
  </form>

  <p id="message"></p>

  <script>
    // ★ここを自分の情報に書き換えてください
    const SUPABASE_URL = "https://zadmkthnxgbgsipxciuf.supabase.co";      // あなたのProject URL
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InphZG1rdGhueGdiZ3NpcHhjaXVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM2NjMxNTEsImV4cCI6MjA1OTIzOTE1MX0.dv5vl3aZ6gcaDHi2-W3F4rT4wTrB3U1jgretX-yG_VU"; // あなたのanon key

    const form = document.getElementById("condition-form");
    const messageEl = document.getElementById("message");

    form.addEventListener("submit", async (event) => {
      event.preventDefault();  // ページがリロードされるのを止める
      messageEl.textContent = "送信中です...";

      const formData = new FormData(form);

      // Supabaseに送るデータ
      const data = {
        date: formData.get("date"),
        team: formData.get("team"),
        name: formData.get("name"),
        exported: false  // 新規は未出力扱い
      };

      try {
        const res = await fetch(`${SUPABASE_URL}/rest/v1/condition`, {
          method: "POST",
          headers: {
            "apikey": SUPABASE_ANON_KEY,
            "Authorization": `Bearer ${SUPABASE_ANON_KEY}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        });

        if (!res.ok) {
          const text = await res.text();
          messageEl.textContent = `エラー：${res.status} ${text}`;
        } else {
          messageEl.textContent = "送信できました。ありがとうございました！";
          form.reset();
        }
      } catch (error) {
        console.error(error);
        messageEl.textContent = "通信エラーが発生しました。ネットワークを確認してください。";
      }
    });
  </script>
</body>
</html>
